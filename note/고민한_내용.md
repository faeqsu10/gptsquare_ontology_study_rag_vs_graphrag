# 고민한 내용

neo4j
질문 - 사이퍼쿼리 - 정답

1. 질문을 무엇으로 할 것인가?

2. 사이퍼쿼리

3. 정답을 어떻게 확인할 것인가?
- pandas로 확인
- neo4j 쿼리 결과와 비교

4. 그래프db를 어떻게 활용할 것인가?
- 질문과 관련된 온톨로지 정보를 LLM에게 프롬프트로 공유할 수 있는가? (스키마 정보?)
- 단순히 질문에 대한 사이퍼 쿼리와 그에 대한 결과만 LLM에게 프롬프트로 제공할 것인가?
- vectordb, graphdb를 하이브리드로 사용할때, 프롬프트에 주어지는 내용은 어떻게 구성할 것인가?
- graphdb 스키마 정보, graphdb 사이퍼쿼리 및 답변, rag 검색 및 답변
- LLM에게 효과를 줄 수 있는 온톨로지 정보는 무엇인가?
- 그러니까 온톨로지구축한 내용에서. 특정 질문에 대한. LLM에게 줄 수 있는. 온톨로지에서 뽑아낼 수 있는 정보는 무엇이고. 그것을 어떻게 뽑아내야 하는가. 구체적인 예를 들어 설명해줘.

->
사이퍼 쿼리 조회 - 분할 정보 프롬프트
사용자 질의 - 사용자 질의에서 뽑아낼 수 있는 정보 분할 - 각 정보 사이퍼 쿼리로 조회 - 조회한 정보 - 프롬프트로 전달

1. 사용자 질문
2. 사용자 질문 분해 - 보조 질문 생성
3. 각 보조 질문 실행 - 결과
4. 각 결과값을 참조하여 본 사용자 질문 실행
5. 결과 생성

=> 
보조 쿼리로 생성된 결과의 토큰 수가 긴 경우가 발생 - 프롬프트로 넘기기엔 비용이 큼

어디까지 넘기는게 좋을까?
서브 질문에 대한 결과값을 넘기는게 아니고,
서브 질문에 대한 사이퍼 쿼리만 넘겨서
본 쿼리에 대한 사이퍼 쿼리를 잘 작성하기 위한 재료로 사용해야 하는게 좋을까?

=>
보조 쿼리에 대한 사이퍼 쿼리 텍스트만 context로 전달
(복잡한 최종 쿼리 작성을 위한 경로 탐색 역할)


---

파이프라인 구현
1. RAG (rag.py)
사용자 질문 - Vector DB 검색 - 프롬프트 전달 - LLM 결과 생성

2. GRAPH RAG (graph_rag.py)
사용자 질문 - Cypher쿼리 - Graph DB 검색 - 프롬프트 전달 - LLM 결과 생성

3. 하이브리드 (hybrid_rag.py)
(a) Graph DB - 에서 뽑은 내용 
(b) Vector DB - 에서 뽑은 내용 
(c) ((a) (b)) 프롬프트 전달 - LLM 결과 생성


프레임워크
ChromaDB, Neo4j, LangChain, OpenAI

---


